# 后端系统开发

刘佳璐
7.22

## 一、登录（验证码前端实现）

1. 验证码的生成是前后端第一次的交互。
   生成逻辑（基本思路）：
   后端生成一个表达式，1+1=2，1+1=？@2.
   @后面是答案，前面是题目；
   再把题干转换成流生成图片转给前端。
   数值2存入redis
   用户输入的验证码传到后台与redis中存入的key值对比
   在前端有隐藏域存入当前的key值

2. 页面都在views（src目录下）

3. login页面是使用Vue.js框架结合Element UI组件库搭建的。

   login页面初始化的方法在created里面

   ```javascript
   created(){
   this.getCode()
   this.getCookie()
   }
   ```

   getcode获取验证码;cookie获取当前页面或应用中相关的 Cookie 数据。

   ```javascript
   if(this.captchaEnabled){
   this.codeUrl="data:iamge/gif;base64,"+res.img
   this.loginForm.uuid=res.uuid
   }
   ```

   * res.uuid（后端回复）转递到前端loginForm.uuid表单存起来；
     uuid对应的key值，不会重复；
     总体逻辑就是后端返图片+uuid，前端记录。

>Vue获取图片是后端

反向代理，url请求前端，进行代理，映射到后端，解决跨域问题

![image-20250722010811029](C:/Users/刘佳璐/AppData/Roaming/Typora/typora-user-images/image-20250722010811029.png)

 ## 二、验证码后端实现

1. idea全局搜索：ctrl+shift+f

   ![image-20250722224428877](C:/Users/刘佳璐/AppData/Roaming/Typora/typora-user-images/image-20250722224428877.png)

   ![image-20250722224452932](C:/Users/刘佳璐/AppData/Roaming/Typora/typora-user-images/image-20250722224452932.png)

   为寻找验证码流程。

## 三、登陆的实现

![image-20250725063007820](C:/Users/刘佳璐/AppData/Roaming/Typora/typora-user-images/image-20250725063007820.png)

 后端流程：

首先用户在前端登录页面输入用户名和密码，点击登录按钮后，前端会将这些信息通过 AJAX 或其他方式封装成一个 HTTP POST 请求，发送到后端指定的登录接口，一般是 `/login` 。

1.校验验证码：
若依默认支持验证码功能。后端接收到登录请求后，首先会检查前端传来的验证码是否正确。如果开启了验证码，会从 Redis 中获取之前生成并存储的验证码，与用户输入的验证码进行比对。若验证码错误，直接返回错误提示，阻止后续登录流程。

2.校验用户名和密码：
若验证码校验通过，后端会从请求中提取用户名和密码。然后根据用户名从数据库（ MySQL ）中查询对应的用户记录。获取到用户记录后，对用户输入的密码进行加密处理（若依通常使用 BCrypt 加密算法），并与数据库中存储的加密密码进行比对。如果密码不一致，返回错误提示告知用户用户名或密码错误。

3.生成Token：
后端使用 JWT（JSON Web Token） 技术生成一个包含用户信息（如用户 ID、用户名、角色等）的 Token。生成 Token 后，将其返回给前端。同时，为了实现一些扩展功能（如限制登录状态、单点登录等），也会将 Token 存储到 Redis 中，设置一个合理的过期时间（比如 2 小时）。

 